function escapeHTML(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}const soundSelectors=[{sel:"nav a, .social-icons a, a.contact-link, .tab-btn, #p-title, .project-info-side h1, .brand h1",type:"click"},{sel:".hero-img, .project-card, .contact-img-wrapper, .contact-random-img, .project-thumb img",type:"shutter"}],isMobileDevice=()=>window.matchMedia("(max-width: 768px)").matches||"ontouchstart"in window&&window.innerWidth<=1024;function initMobileMenu(){const e=document.getElementById("hamburger-menu"),t=document.getElementById("mobile-menu-overlay"),n=document.getElementById("menu-close");if(!e||!t)return;let o=0,i=!1;const a=e.querySelector(".hamburger-label"),s=()=>{i=!0,o=window.scrollY,document.body.style.position="fixed",document.body.style.top=`-${o}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.overflow="hidden",t.classList.add("is-open"),e.classList.add("is-active"),a&&(a.textContent="Close")},l=()=>{i=!1,t.classList.remove("is-open"),e.classList.remove("is-active"),a&&(a.textContent="Menu"),setTimeout(()=>{document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.overflow="",window.scrollTo(0,o)},400)};e.addEventListener("click",()=>{i?l():s()}),n&&n.addEventListener("click",l),t.querySelectorAll(".mobile-menu-nav a").forEach(e=>{e.addEventListener("click",l)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&i&&l()}),t.addEventListener("touchmove",e=>{e.preventDefault()},{passive:!1})}function beautifyURL(){const e=window.location.pathname;if(e.length>1&&e.endsWith("/")){const t=e.slice(0,-1);history.replaceState(null,"",t+window.location.search)}}function initBarba(){"undefined"!=typeof barba?(barba.init({transitions:[{name:"default-transition",leave:e=>new Promise(t=>{e.current.container.style.opacity=0,e.current.container.style.transition="opacity 0.25s ease",setTimeout(t,250)}),enter:e=>(e.next.container.style.opacity=0,e.next.container.style.transition="opacity 0.3s ease",e.next.container.offsetWidth,e.next.container.style.opacity=1,new Promise(e=>setTimeout(e,300)))}],views:[]}),barba.hooks.beforeEnter(e=>{updateActiveNavLink(e.next.url.path),window.scrollTo(0,0)}),barba.hooks.after(e=>{loadPageContent(e.next.container),refreshGlobalSounds(),wrapper&&(wrapper.style.overflow="")})):console.warn("Barba.js not loaded. Falling back to standard navigation.")}document.addEventListener("DOMContentLoaded",()=>{beautifyURL(),initTheme(),initSnowSystem(),initSoundSystem(),initMobileMenu(),refreshGlobalSounds(),initBarba(),loadPageContent(document.querySelector("main"))});let cachedData=null,cacheTimestamp=0;const CACHE_TTL=6e4;function loadPageContent(e){const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)",t.unobserve(e.target))})},{threshold:.1});e.querySelectorAll("img").forEach(e=>{e.addEventListener("contextmenu",e=>e.preventDefault()),e.addEventListener("dragstart",e=>e.preventDefault())});const n=e.dataset.barbaNamespace,o=o=>{const i=o.projects,a=o.site||{},s=document.querySelector(".copyright");if(s&&a.copyright){const e=a.copyright;s.innerHTML=e.toLowerCase().includes("copyright")?e:`&copy; ${e}`}document.querySelectorAll('a[aria-label="Instagram"]').forEach(e=>{if(a.header_social_instagram){let t=a.header_social_instagram;t.startsWith("http")||t.startsWith("//")||(t="https://"+t),e.href=t}}),document.querySelectorAll('a[aria-label="Link"]').forEach(e=>{if(a.header_social_link){let t=a.header_social_link;t.startsWith("http")||t.startsWith("//")||(t="https://"+t),e.href=t,e.style.display=""}else e.style.display="none"}),document.querySelectorAll('a[aria-label="Email"]').forEach(e=>{if(a.header_social_email){let t=a.header_social_email;e.href=t.startsWith("mailto:")?t:"mailto:"+t}}),"home"===n?document.body.classList.add("is-home"):document.body.classList.remove("is-home"),"home"===n?populateHome(e,a.home_images,i):"portfolios"===n?populateArchive(e,i,t):"info"===n?populateBio(e,a):"contact"===n?populateContact(e,a,i):("project"===n||window.location.pathname.includes("/project"))&&populateProjectDetail(e,i),document.body.classList.contains("is-void")&&populateVoid(a),refreshGlobalSounds()};cachedData&&Date.now()-cacheTimestamp<CACHE_TTL?o(cachedData):fetch("/data.json?v="+(new Date).getTime()).then(e=>e.json()).then(e=>{cachedData=e,cacheTimestamp=Date.now(),o(e)}).catch(e=>console.error("Data load failed:",e))}function populateHome(e,t,n){const o=e.querySelector(".hero-gallery");if(o&&t&&t.length>0&&(o.innerHTML="",t.forEach((e,t)=>{const n=document.createElement("img");let i="string"==typeof e?e:e.src;!i||i.startsWith("http")||i.startsWith("/")||(i="/"+i),i&&!i.startsWith("http")&&(i=encodeURI(i)),n.src=i,n.className=`hero-img img-${t+1}`,n.loading=t<2?"eager":"lazy",n.decoding="async","object"==typeof e&&e.style&&(Object.assign(n.style,e.style),e.style.top&&!String(e.style.top).includes("%")&&(n.style.top+="%"),e.style.left&&!String(e.style.left).includes("%")&&(n.style.left+="%"),e.style.width&&!String(e.style.width).includes("%")&&(n.style.width+="%")),o.appendChild(n)})),t&&t.length>0){let n=e.querySelector(".mobile-home-projects");n||(n=document.createElement("div"),n.className="mobile-home-projects",e.querySelector(".hero-container").after(n)),n.innerHTML="";const o=[{col:"left",w:62,mt:0,top:0,left:0},{col:"right",w:48,mt:30,top:16,left:52},{col:"left",w:38,mt:-60,top:28,left:0},{col:"right",w:52,mt:30,top:48,left:48},{col:"left",w:44,mt:-30,top:60,left:0}];let i=0;t.forEach((e,t)=>{const a=o[t%o.length],s=document.createElement("div");s.className="mobile-home-card";const l=e&&e.mobile_col||a.col,r=e&&e.mobile_width||a.w,c=e&&void 0!==e.mobile_top&&null!==e.mobile_top?e.mobile_top:a.top,d=e&&void 0!==e.mobile_left&&null!==e.mobile_left?e.mobile_left:a.left;s.setAttribute("data-col",l),s.style.width=r+"%",s.style.top=c+"%",s.style.left=d+"%",s.style.animationDelay=.12*t+"s",i=Math.max(i,c+.75*r);let h="string"==typeof e?e:e.src;!h||h.startsWith("http")||h.startsWith("/")||(h="/"+h),h&&!h.startsWith("http")&&(h=encodeURI(h));const u=e&&e.caption||e&&e.location||"";let m="";u&&(m=`<div class="mobile-home-caption"><span class="caption-text">${u}</span></div>`),s.innerHTML=`\n                <img src="${h}" alt="" loading="lazy" decoding="async">\n                ${m}\n            `,n.appendChild(s)});const a=()=>{let e=0;n.querySelectorAll(".mobile-home-card").forEach(t=>{const n=t.offsetTop+t.offsetHeight;n>e&&(e=n)}),e>0&&(n.style.minHeight=e+40+"px")},s=n.querySelectorAll("img");let l=0;s.forEach(e=>{e.complete?(l++,l===s.length&&a()):(e.addEventListener("load",()=>{l++,l===s.length&&a()}),e.addEventListener("error",()=>{l++,l===s.length&&a()}))});const r=Math.max(600,8*i);n.style.minHeight=r+"px"}}function populateArchive(e,t,n){const o=e.querySelector(".archive-grid");o&&(o.innerHTML="",t.forEach((e,t)=>{const i=document.createElement("a");i.href=`/project?id=${e.id}`,i.className="project-card";let a=e.image.trim();a.startsWith("http")||a.startsWith("/")||(a="/"+a);const s=encodeURI(a);i.innerHTML=`\n            <div class="project-thumb">\n                <img src="${s}" alt="${escapeHTML(e.title)}" loading="lazy">\n            </div>\n            <div class="project-info">\n                <h2>${escapeHTML(e.title)}</h2>\n                <span>${escapeHTML(e.year)}</span>\n            </div>\n        `,i.style.opacity="0",i.style.transform="translateY(20px)",i.style.transition="opacity 0.8s ease, transform 0.8s ease-out",o.appendChild(i),n.observe(i)}))}function populateBio(e,t){const n=e.querySelector(".bio-text");n&&t.bio&&(n.innerHTML=t.bio);const o=e.querySelector(".bio-container");if(o&&t.bio_layout){const e=t.bio_layout;e.padding_left&&(o.style.paddingLeft=e.padding_left+"px"),e.width&&(o.style.width=e.width+"%"),e.max_width&&(o.style.maxWidth=e.max_width+"px"),e.top&&(o.style.paddingTop=e.top+"px")}}function populateContact(e,t,n){const o=e.querySelector(".contact-info-side"),i=e.querySelector(".contact-gallery-side");if(o){let e="";t.contact_items&&Array.isArray(t.contact_items)&&t.contact_items.forEach(t=>{const n=escapeHTML(t.label),o=escapeHTML(t.value),i=t.link?`<a href="${escapeHTML(t.link)}" target="_blank" class="contact-link">${o}</a>`:`<span class="contact-link">${o}</span>`;e+=`<div class="contact-row"><span class="contact-label">${n}</span>${i}</div>`}),o.innerHTML=e}if(i){i.innerHTML="";let e=[];n.forEach(t=>{t.image&&e.push({src:t.image,id:t.id}),t.gallery&&t.gallery.forEach(n=>e.push({src:"string"==typeof n?n:n.src,id:t.id}))}),e.sort(()=>Math.random()-.5);e.slice(0,3).forEach((e,t)=>{const n=document.createElement(e.id?"a":"div");e.id&&(n.href=`/project?id=${e.id}`),n.className="contact-img-wrapper",n.style.display="block",n.style.width="100%";const o=document.createElement("img");let a=e.src;!a||a.startsWith("http")||a.startsWith("/")||(a="/"+a),o.src=a,o.className="contact-random-img",o.style.transitionDelay=.2*t+"s",n.appendChild(o),i.appendChild(n);const s=50+200*t+1e3;setTimeout(()=>{o.style.opacity="1"},50),setTimeout(()=>{o.style.transitionDelay="0s"},s)})}}function populateVoid(e){const t=document.querySelector(".void-text");if(!t)return;const n=e.void_messages;if(n&&n.length>0){const e=n[Math.floor(Math.random()*n.length)];t.textContent=e}else t.textContent="The page you seek has dissolved into light."}function populateProjectDetail(e,t){const n=e.querySelector("#project-content");if(!n)return;const o=new URLSearchParams(window.location.search).get("id"),i=t.find(e=>e.id===o);if(i){document.title=`${i.title.toLowerCase()} | hazelkahlil`;const e=i.description?`<div class="project-desc">${i.description}</div>`:'<div class="project-desc"></div>';let t="";i.gallery_layout&&(i.gallery_layout.width&&(t+=`width: ${i.gallery_layout.width}%; `),i.gallery_layout.top&&(t+=`position: relative; top: ${i.gallery_layout.top}%; `),i.gallery_layout.left&&(t+=`position: relative; left: ${i.gallery_layout.left}%; `));const o=i.gallery&&i.gallery.length>0?i.gallery:[i.image];let a="";o.forEach((e,n)=>{let o="string"==typeof e?e:e.src;if(!o)return;o.startsWith("http")||o.startsWith("/")||(o="/"+o);let s=encodeURI(o),l="object"==typeof e&&e.caption?e.caption:"Location, Year, Subject";const r=0===n?"":'loading="lazy"';a+=`\n                <div class="gallery-slide ${0===n?"active":""}" data-index="${n}">\n                    <figure class="slide-figure">\n                        <div class="image-wrapper">\n                            <img src="${s}" alt="${i.title} ${n+1}" style="${t}" ${r} decoding="async">\n                        </div>\n                        <figcaption>${l}</figcaption>\n                    </figure>\n                </div>\n            `});let s="";i.layout&&(i.layout.top&&(s+=`padding-top: ${i.layout.top}px; `),i.layout.left&&(s+=`padding-left: ${i.layout.left}px; `),i.layout.width&&(s+=`width: ${i.layout.width}%; `),i.layout.max_width&&(s+=`max-width: ${i.layout.max_width}px; `)),n.innerHTML=`\n            <div class="project-split">\n                <div class="project-info-side" style="${s}">\n                    <h1 id="p-title">${escapeHTML(i.title)}</h1>\n                    <div class="meta" id="p-year">${escapeHTML(i.year)}</div>\n                    ${e}\n                </div>\n                <div class="project-gallery-side">\n                    <div class="gallery-slider-container">\n                        ${a}\n                        <div class="slider-nav-area nav-left"></div>\n                        <div class="slider-nav-area nav-right"></div>\n                    </div>\n                    <button class="slider-arrow arrow-left" aria-label="Previous">‹</button>\n                    <button class="slider-arrow arrow-right" aria-label="Next">›</button>\n                </div>\n                <div class="mobile-swipe-hints" aria-hidden="true">\n                    <span class="swipe-hint-arrow swipe-hint-left" style="visibility: hidden;">\n                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>\n                    </span>\n                    <span class="swipe-hint-arrow swipe-hint-right">\n                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>\n                    </span>\n                </div>\n                <div class="slider-counter">1 / ${o.length}</div>\n            </div>\n        `,n.querySelectorAll(".gallery-slide img").forEach(e=>{const t=()=>{if(e.naturalHeight>e.naturalWidth){const t=e.closest(".gallery-slide");t&&t.classList.add("is-portrait")}};e.complete&&e.naturalWidth>0?t():e.addEventListener("load",t,{once:!0})});let l=0;const r=o.length,c=n.querySelectorAll(".gallery-slide"),d=n.querySelector(".slider-counter"),h=n.querySelector(".nav-left"),u=n.querySelector(".nav-right"),m=n.querySelector(".arrow-left"),p=n.querySelector(".arrow-right"),y=(e,t=!0)=>{c.forEach(e=>e.classList.remove("active")),c[e].classList.add("active"),d&&(d.innerText=`${e+1} / ${r}`),t&&playSound("click")};h&&h.addEventListener("click",()=>{l=(l-1+r)%r,y(l)}),u&&u.addEventListener("click",()=>{l=(l+1)%r,y(l)}),m&&m.addEventListener("click",e=>{e.stopPropagation(),l=(l-1+r)%r,y(l)}),p&&p.addEventListener("click",e=>{e.stopPropagation(),l=(l+1)%r,y(l)}),c.forEach(e=>{const t=e.querySelector("img");t&&(t.style.cursor="pointer",t.addEventListener("click",()=>{l=(l+1)%r,y(l)}))});const f=n.querySelector(".gallery-slider-container");if(f){if(window.innerWidth<=768){let e,t=!1;const o=n.querySelector(".mobile-swipe-hints"),i=n.querySelector(".swipe-hint-left"),a=n.querySelector(".swipe-hint-right"),s=e=>{i&&a&&(i.style.visibility=e<=0?"hidden":"visible",a.style.visibility=e>=r-1?"hidden":"visible")};f.addEventListener("scroll",()=>{!t&&o&&(t=!0,o.classList.add("fade-out")),clearTimeout(e),e=setTimeout(()=>{const e=f.offsetWidth;if(e>0){const t=Math.round(f.scrollLeft/e);l=Math.min(t,r-1),d&&(d.innerText=`${l+1} / ${r}`),s(l)}},150)},{passive:!0});let c=0,h=0,u=!1;f.addEventListener("touchstart",e=>{c=e.touches[0].clientX,h=f.scrollLeft},{passive:!0}),f.addEventListener("touchend",e=>{if(u)return;const t=e.changedTouches[0].clientX,n=c-t,o=f.offsetWidth;if(!(Math.abs(n)<40))if(n>0&&l>=r-1)u=!0,f.style.scrollBehavior="auto",f.scrollLeft=0,f.style.scrollBehavior="",l=0,d&&(d.innerText=`1 / ${r}`),s(0),setTimeout(()=>{u=!1},300);else if(n<0&&l<=0&&h<=0){u=!0;const e=o*(r-1);f.style.scrollBehavior="auto",f.scrollLeft=e,f.style.scrollBehavior="",l=r-1,d&&(d.innerText=`${r} / ${r}`),s(r-1),setTimeout(()=>{u=!1},300)}},{passive:!0}),o&&setTimeout(()=>{t||o.classList.add("fade-out")},4e3)}else{let e=0,t=0;f.addEventListener("touchstart",t=>{e=t.changedTouches[0].screenX},{passive:!0}),f.addEventListener("touchend",n=>{t=n.changedTouches[0].screenX;const o=t-e;Math.abs(o)>50&&(l=o>0?(l-1+r)%r:(l+1)%r,y(l))},{passive:!0})}}n.querySelectorAll("h1, .gallery-slide img").forEach(e=>bindSound(e))}else n.innerHTML=`<h1>Project Not Found</h1><p>The requested project ID '${o}' does not exist.</p>`}let navEventsInitialized=!1;function updateActiveNavLink(e){let t=e.split("?")[0].replace(/\/$/,"").replace(".html","");""!==t&&"/index"!==t||(t="/");const n=document.querySelectorAll("nav a"),o=document.querySelector("nav");document.querySelector(".nav-indicator");let i=null;n.forEach(e=>{const n=e.getAttribute("href");if(!n)return;let o=n.replace(/\/$/,"").replace(".html","");""!==o&&"/index"!==o||(o="/");o===t?(e.classList.add("active"),i=e):e.classList.remove("active")}),!navEventsInitialized&&o&&(n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(e=>e.classList.remove("active")),e.classList.add("active")})}),navEventsInitialized=!0)}function refreshGlobalSounds(){soundSelectors.forEach(({sel:e,type:t})=>{document.querySelectorAll(e).forEach(e=>bindSound(e))})}let soundAssets={};function initSoundSystem(){isMobileDevice()||(soundAssets={click:new Audio("assets/sounds/text_custom.mp3"),shutter:new Audio("assets/sounds/image_custom.mp3")},Object.values(soundAssets).forEach(e=>{e.volume=.2,e.load()}))}function playSound(e){const t=soundAssets[e];t&&(t.currentTime=0,t.play().catch(()=>{}))}function bindSound(e){e.dataset.soundBound||isMobileDevice()||soundSelectors.forEach(({sel:t,type:n})=>{e.matches(t)&&(e.addEventListener("mouseenter",()=>playSound(n)),e.dataset.soundBound="true")})}function initTheme(){const e=document.getElementById("theme-toggle");"dark"===localStorage.getItem("theme")&&document.documentElement.setAttribute("data-theme","dark"),updateSnowColor(),e&&(e.onclick=()=>{const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.body.classList.add("theme-transitioning"),document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),updateSnowColor(),setTimeout(()=>{document.body.classList.remove("theme-transitioning")},700)})}let snowColor="rgba(173, 216, 230, 0.7)";function updateSnowColor(){const e="dark"===document.documentElement.getAttribute("data-theme");snowColor=e?"rgba(255, 255, 255, 0.8)":"rgba(173, 216, 230, 0.7)"}function initSnowSystem(){const e=document.getElementById("snow-toggle");if(!e)return;let t,n,o,i,a="true"===localStorage.getItem("isSnowing"),s=0;function l(){t.classList.remove("fading-out"),t.style.display="block";const o=window.devicePixelRatio||1,i=Math.max(o,2);n.setTransform(1,0,0,1,0,0),n.scale(i,i),e.classList.add("active"),s=0,r(),t.offsetWidth,t.style.opacity="1",t.classList.add("fading-in")}function r(){n.clearRect(0,0,window.innerWidth,window.innerHeight),n.fillStyle=snowColor,n.beginPath(),s+=1;for(let e=0,t=o.length;e<t;e++){const t=o[e],i=Math.sin(s*t.swayFrequency+t.swayPhase)*t.swayAmplitude*t.wobble;t.x+=i+t.drift,t.y+=t.s,t.x>window.innerWidth+10&&(t.x=-10),t.x<-10&&(t.x=window.innerWidth+10),t.y>window.innerHeight&&(t.y=-10,t.x=Math.random()*window.innerWidth),n.moveTo(t.x,t.y),n.arc(t.x,t.y,t.r,0,2*Math.PI)}n.fill(),i=requestAnimationFrame(r)}!function(){t=document.createElement("canvas"),t.id="snow-canvas",t.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:99999;display:none;opacity:0;",document.body.appendChild(t);const e=window.devicePixelRatio||1,i=Math.max(e,2);let a;t.width=window.innerWidth*i,t.height=window.innerHeight*i,n=t.getContext("2d"),n.scale(i,i),window.addEventListener("resize",()=>{clearTimeout(a),a=setTimeout(()=>{const e=Math.max(window.devicePixelRatio||1,2);t.width=window.innerWidth*e,t.height=window.innerHeight*e,n.setTransform(1,0,0,1,0,0),n.scale(e,e)},150)});const s=window.innerWidth<=768?200:350;o=Array.from({length:s},()=>{const e=1*Math.random()+.5;let t=.5;return e<1&&Math.random()<.5&&(t=.75),{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,r:e,s:(.8*Math.random()+.3)*t,swayAmplitude:.5*Math.random()+.3,swayFrequency:(.015*Math.random()+.008)*t,swayPhase:Math.random()*Math.PI*2,drift:.2*(Math.random()-.5)*t,wobble:.4*Math.random()+.4}})}(),e.onclick=()=>{a=!a,localStorage.setItem("isSnowing",a),a?l():(e.classList.remove("active"),t.classList.remove("fading-in"),t.classList.add("fading-out"),t.style.opacity="0",setTimeout(()=>{cancelAnimationFrame(i),t.style.display="none",t.classList.remove("fading-out")},350))},a&&l()}